<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading Article... | NeonFuture</title>
    
    <!-- SEO Placeholders -->
    <meta id="metaDesc" name="description" content="">
    <meta id="ogTitle" property="og:title" content="">
    <meta id="ogImage" property="og:image" content="">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Space+Grotesk:wght@300;500;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                        mono: ['Space Grotesk', 'monospace'],
                    },
                    colors: {
                        neon: { purple: '#b026ff', blue: '#00f3ff', pink: '#ff00aa' }
                    },
                    typography: (theme) => ({
                        DEFAULT: {
                            css: {
                                color: theme('colors.gray.300'),
                                h1: { color: theme('colors.white') },
                                h2: { color: theme('colors.white') },
                                strong: { color: theme('colors.neon.blue') },
                            }
                        }
                    })
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #0f172a;
            background-image: radial-gradient(circle at top, #1e293b 0%, #0f172a 100%);
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .prose-glow {
            text-shadow: 0 0 1px rgba(255,255,255,0.1);
        }
    </style>
</head>
<body class="text-gray-100 min-h-screen flex flex-col">

    <!-- Navbar (Simple Back Button) -->
    <nav class="fixed top-0 w-full z-50 glass-panel border-b border-white/10 h-16 flex items-center px-6 justify-between">
        <a href="index.html" class="flex items-center text-neon-blue hover:text-white transition gap-2 font-mono text-sm">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
            RETURN_TO_GRID
        </a>
        <div class="font-mono font-bold tracking-widest text-white">NEON<span class="text-neon-purple">READER</span></div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow pt-24 pb-12 px-4 sm:px-6 lg:px-8 max-w-4xl mx-auto w-full">
        
        <div id="loading" class="text-center py-20 text-neon-blue font-mono animate-pulse">
            DECRYPTING_DATA_PACKET...
        </div>

        <article id="articleContent" class="hidden">
            <!-- Header -->
            <header class="mb-8">
                <div class="flex gap-3 mb-4">
                    <span id="artCategory" class="px-3 py-1 text-xs font-bold uppercase tracking-wider text-black bg-neon-blue rounded-sm"></span>
                    <span id="artDate" class="px-3 py-1 text-xs font-mono text-gray-400 border border-gray-600 rounded-sm"></span>
                </div>
                <h1 id="artTitle" class="text-4xl md:text-6xl font-bold mb-6 bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-400 leading-tight"></h1>
                <div id="artTags" class="flex flex-wrap gap-2 mb-8"></div>
            </header>

            <!-- Image -->
            <div class="relative w-full h-[400px] mb-12 rounded-2xl overflow-hidden glass-panel">
                <img id="artImage" class="w-full h-full object-cover" src="" alt="Article Image">
                <div class="absolute inset-0 bg-gradient-to-t from-gray-900 to-transparent opacity-60"></div>
            </div>

            <!-- Body -->
            <div class="glass-panel p-8 md:p-12 rounded-2xl">
                <div id="artBody" class="prose prose-lg prose-invert max-w-none font-sans leading-loose text-gray-300">
                    <!-- Content injected here -->
                </div>
            </div>
        </article>

        <!-- Related -->
        <section id="relatedSection" class="mt-16 hidden">
            <h3 class="text-2xl font-mono font-bold mb-6 text-neon-pink border-b border-gray-800 pb-2">RELATED_DATA</h3>
            <div id="relatedGrid" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Related items -->
            </div>
        </section>

    </main>

    <footer class="py-8 text-center text-gray-600 text-xs font-mono border-t border-white/5 mt-auto">
        END_OF_FILE
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getFirestore, collection, getDoc, doc, getDocs, where, limit, query } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

        // --- CONFIG MANAGER ---
        const firebaseConfig = {
            apiKey: "AIzaSyCRVzGKgsx7BFm2uzEBlMygAotqOI4MAGI",
            authDomain: "article-c684c.firebaseapp.com",
            projectId: "article-c684c",
            storageBucket: "article-c684c.firebasestorage.app",
            messagingSenderId: "582345070686",
            appId: "1:582345070686:web:1c4615597777632288bccf",
            measurementId: "G-93859FWR87"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- INIT ---
        const params = new URLSearchParams(window.location.search);
        const postId = params.get('id');

        document.addEventListener('DOMContentLoaded', () => {
            if (!postId) {
                window.location.href = 'index.html';
            } else {
                loadArticle(postId);
            }
        });

        async function loadArticle(id) {
            try {
                const docRef = doc(db, 'posts', id);
                const docSnap = await getDoc(docRef);
                
                if (!docSnap.exists()) {
                    document.body.innerHTML = "<div class='text-center pt-20 text-white'>404: DATA_CORRUPTED (Article Not Found)</div>";
                    return;
                }

                const data = docSnap.data();

                // Update DOM
                document.title = `${data.title} | NeonFuture`;
                document.getElementById('artTitle').innerText = data.title;
                document.getElementById('artCategory').innerText = data.category;
                document.getElementById('artDate').innerText = data.createdAt ? new Date(data.createdAt.seconds * 1000).toLocaleDateString() : 'Unknown';
                document.getElementById('artImage').src = data.imageUrl || 'https://picsum.photos/800/400';
                
                // Content (convert newlines to br for simple formatting)
                document.getElementById('artBody').innerHTML = data.content.split('\n').map(p => `<p>${p}</p>`).join('');
                
                // Tags
                const tagsContainer = document.getElementById('artTags');
                (data.tags || []).forEach(tag => {
                    tagsContainer.innerHTML += `<span class="text-neon-purple font-mono text-sm mr-2">#${tag}</span>`;
                });

                // Meta SEO
                document.getElementById('metaDesc').content = data.content.substring(0, 150);
                document.getElementById('ogTitle').content = data.title;
                document.getElementById('ogImage').content = data.imageUrl;

                // Show
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('articleContent').classList.remove('hidden');

                // Load Related asynchronously
                loadRelated(data.category, id);

            } catch (error) {
                console.error(error);
                if (error.code === 'permission-denied' || error.message.includes('Cloud Firestore API has not been used')) {
                    const msg = "Please enable Firestore in Firebase Console.";
                    document.body.innerHTML = `<div class='text-center pt-20 text-red-500 font-bold'>${msg}</div>`;
                } else {
                    alert('Error fetching data');
                }
            }
        }

        async function loadRelated(category, currentId) {
            try {
                // Simple query to get same category
                // If this fails due to indexing, we catch it silently so the main article still shows
                const q = query(
                    collection(db, 'posts'),
                    where('category', '==', category),
                    where('status', '==', 'published'),
                    limit(4)
                );
                
                const snap = await getDocs(q);
                
                const relatedGrid = document.getElementById('relatedGrid');
                let count = 0;

                snap.forEach(doc => {
                    if(doc.id !== currentId && count < 3) {
                        const p = doc.data();
                        relatedGrid.innerHTML += `
                            <a href="article.html?id=${doc.id}" class="glass-panel p-4 rounded-xl hover:bg-white/10 transition group">
                                <div class="h-32 rounded-lg overflow-hidden mb-3">
                                    <img src="${p.imageUrl}" class="w-full h-full object-cover group-hover:scale-110 transition">
                                </div>
                                <h4 class="font-bold text-white text-sm truncate">${p.title}</h4>
                                <span class="text-xs text-gray-400 font-mono">${p.category}</span>
                            </a>
                        `;
                        count++;
                    }
                });

                if(count > 0) document.getElementById('relatedSection').classList.remove('hidden');
            } catch (e) {
                console.warn("Related posts could not be loaded (likely missing index or permission)", e);
            }
        }
    </script>
</body>
</html>
